<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "NEL" %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbo-track': 'reload' %>
    <%= javascript_include_tag "application", defer: true %>

    <!-- Favicon -->
    <link rel="icon" href="/assets/New%20era%20lissoise.png" type="image/png" style="width: 32px; height: 32px;">
  </head>

  <body>
    <div class="wrapper">
      <!-- Flash Messages -->
      <div class="flash-messages">
        <% flash.each do |key, message| %>
          <div class="flash alert-<%= key %>"><%= message %></div>
        <% end %>
      </div>

      <header class="header">
        <div class="header-container">
          <!-- Burger Menu Button (Visible only on small screens) -->
          <button class="burger-menu" id="burger-menu">
            â˜°
          </button>

          <!-- Welcome Message -->
          <div class="welcome-message">
            <% if user_signed_in? %>
              <p>Welcome, <%= current_user.username.presence || "User" %>!</p>
            <% else %>
              <p>Welcome to our website!</p>
            <% end %>
          </div>

          <!-- Navigation Menu -->
          <nav class="footer-content footer-links nav-menu active desktop-visible" id="nav-menu">
            <% if user_signed_in? %>
              <%= link_to 'Home', root_path, class: 'btn' %> 
              <%= link_to 'Members', members_path, class: 'btn' %>
              <%= link_to 'Weather', 'http://127.0.0.1:3000/weather', class: 'btn' %>
              <% if current_user.admin? || current_user.super_admin? %>
                <%= link_to 'Admin', admin_root_path, class: 'btn' %>
              <% end %>
              <%= button_to 'Logout', destroy_user_session_path, method: :delete, class: 'btn btn-danger' %>
            <% else %>
              <%= link_to 'Sign Up', signup_path, class: 'btn' %>
              <%= link_to 'Login', login_path, class: 'btn' %>
            <% end %>
          </nav>
        </div>
      </header>

      <main class="content">
        <%= yield %>
      </main>

      <footer class="footer">
        <div class="footer-content footer-links">
          <%= link_to 'Contact Us', contact_path, class: 'btn' %>
          <%= link_to 'About Us', about_path, class: 'btn' %>
          <%= link_to 'Privacy Policy', cgu_path, class: 'btn' %>
          <% if user_signed_in? && current_user.over_18? %>
            <%= link_to 'Donate', 'https://donate.stripe.com/test_6oE9CBaC09Nj1dScMM', class: 'btn', target: '_blank', rel: 'noopener noreferrer' %>
          <% end %>
        </div>
      </footer>
    </div>

    <!-- JavaScript for the burger menu -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const burgerMenu = document.getElementById("burger-menu");
        const navMenu = document.getElementById("nav-menu");

        // Toggle navigation menu when burger button is clicked
        burgerMenu.addEventListener("click", function (event) {
          event.stopPropagation(); // Prevents immediate closing
          navMenu.classList.toggle("active");
        });

        // Close the menu if a click happens outside
        document.addEventListener("click", function (event) {
          if (!burgerMenu.contains(event.target) && !navMenu.contains(event.target)) {
            navMenu.classList.remove("active");
          }
        });

        // Ensure the menu is always visible on larger screens
        function checkScreenSize() {
          if (window.innerWidth > 600) {
            navMenu.classList.add("desktop-visible");
          } else {
            navMenu.classList.remove("desktop-visible");
          }
        }

        checkScreenSize(); // Initial check
        window.addEventListener("resize", checkScreenSize); // Check on resize
      });
    </script>
  </body>
</html>
